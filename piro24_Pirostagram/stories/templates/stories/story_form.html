{% extends 'base.html' %}

{% block content %}
<style>
    /* ... (CSS는 기존과 동일하게 유지) ... */
    .upload-wrapper { display: flex; justify-content: center; align-items: center; min-height: 80vh; }
    .upload-box { background: white; border: 1px solid var(--border-color); border-radius: 12px; width: 100%; max-width: 500px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    
    .box-header { border-bottom: 1px solid var(--border-color); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; font-weight: 600; font-size: 16px; }
    .btn-share { background: none; border: none; color: var(--btn-blue); font-weight: 600; font-size: 14px; cursor: pointer; }
    
    .upload-body { padding: 40px; text-align: center; min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .media-icon { font-size: 60px; color: var(--text-main); margin-bottom: 20px; }
    .upload-text { font-size: 20px; font-weight: 300; margin-bottom: 20px; }
    .custom-file-label { background-color: var(--btn-blue); color: white; padding: 8px 15px; border-radius: 4px; font-weight: 600; font-size: 14px; cursor: pointer; display: inline-block; }
    
    /* 기존 스타일 유지 */
    #id_image { display: none; }
    .preview-container { width: 100%; display: none; margin-top: 20px; white-space: nowrap; overflow-x: auto; padding-bottom: 10px; }
    .preview-item { display: inline-block; margin-right: 10px; width: 150px; height: 250px; border-radius: 8px; overflow: hidden; position: relative; border: 1px solid #dbdbdb; }
    .preview-img { width: 100%; height: 100%; object-fit: cover; }
</style>

<div class="upload-wrapper">
    <div class="upload-box">
        <form method="post" enctype="multipart/form-data" id="storyUploadForm">
            {% csrf_token %}
            
            <div class="box-header">
                <span style="width: 30px;"></span>
                <span>새 스토리 만들기</span>
                <button type="button" class="btn-share" onclick="submitForm()">공유하기</button>
            </div>

            <div class="upload-body" id="drop-zone">
                <div id="default-view">
                    <i class="fa-regular fa-images media-icon"></i>
                    <p class="upload-text">사진을 여러 장 선택할 수 있어요</p>
                    
                    <input type="file" name="image" id="id_image" accept="image/*" multiple>
                    
                    <label for="id_image" class="custom-file-label">컴퓨터에서 선택</label>
                </div>

                <div class="preview-container" id="preview-box"></div>
            </div>
        </form>
    </div>
</div>

<script>
    const fileInput = document.getElementById('id_image');
    const previewBox = document.getElementById('preview-box');
    const defaultView = document.getElementById('default-view');
    const form = document.getElementById('storyUploadForm');

    // 파일 선택 시 미리보기 (다중 파일)
    fileInput.addEventListener('change', function(event) {
        const files = event.target.files;
        
        if (files.length > 0) {
            previewBox.innerHTML = ''; // 초기화
            defaultView.style.display = 'none';
            previewBox.style.display = 'block';

            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const div = document.createElement('div');
                    div.className = 'preview-item';
                    
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'preview-img';
                    
                    div.appendChild(img);
                    previewBox.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }
    });

    function submitForm() {
        if (!fileInput.value) {
            alert("사진을 선택해주세요!");
            return;
        }
        form.submit();
    }
</script>
{% endblock %}